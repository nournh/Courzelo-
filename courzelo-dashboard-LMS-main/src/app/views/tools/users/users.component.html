<div class="row mb-3 d-flex align-items-center justify-content-between">
    <!-- Search Bar -->
    <div class="col-md-6 col-lg-4 position-relative">
        <div class="input-group">
            <input id="keyword-users" placeholder="Search Users" [formControl]="searchControl"
                class="form-control form-control-rounded pr-5" type="text">
            <span class="input-group-text position-absolute search-icon"><i class="i-Magnifi-Glass1"></i></span>
        </div>
    </div>
    <!-- Ban Status Filter -->

  
    <!-- Export & Add User Buttons -->
    <div class="col-auto d-flex" style="display: flex; gap: 8px;">
        <button class="btn btn-success export-btn" (click)="exportToExcel()">
            <i class="fas fa-file-export"></i> Exporter la liste
        </button>
       
    </div>
</div>

<!-- User Form Modal -->


<!-- Modal Overlay -->
<div *ngIf="isAddUserModalOpen" class="modal-backdrop fade show"></div>

<!-- User Table -->
<ngx-datatable style="height: calc(100vh - 270px); box-shadow: none; border-radius: 10px; overflow: hidden;"
    class="material fullscreen datatable-header datatable-body"
    [columnMode]="'force'"
    [headerHeight]="50"
    [footerHeight]="0"
    [rowHeight]="85"
    [scrollbarV]="true"
    [scrollbarH]="true"
    [rows]="users | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage, totalItems: totalItems }">

    <ngx-datatable-column name="Email">
        <ng-template ngx-datatable-header-template>Email</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">{{ row.email }}</ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column name="Roles">
        <ng-template ngx-datatable-header-template>Roles</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">
            <div class="role-tags">
                <div *ngFor="let role of row.roles">
                    <app-role [role]="role"></app-role>
                </div>
            </div>
        </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column name="Name">
        <ng-template ngx-datatable-header-template>Name</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">
            {{ row.profile?.name || "N/A" }}
        </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column name="Status">
        <ng-template ngx-datatable-header-template>Status</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">
            <div class="status-tags">
                <span (click)="toggleEnabled(row)" class="status-icon" [title]="row.security?.enabled ? 'Enabled' : 'Disabled'">
                    <i [ngClass]="row.security?.enabled ? 'fas fa-check-circle text-success' : 'fas fa-times-circle text-danger'" class="fs-4"></i>
                </span>
              
            </div>
        </ng-template>
    </ngx-datatable-column>


  
    <!-- Role Management -->
    

   
    <ngx-datatable-column name="Ban">
        <ng-template ngx-datatable-header-template> Ban</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">
            <div class="status-tags">
            <span (click)="toggleBan(row)" class="status-icon" [title]="row.security?.ban ? 'Banned' : 'Not Banned'">
                <i [ngClass]="row.security?.ban ? 'fas fa-ban' : 'fas fa-check-circle text-success'" 
                   [style.color]="row.security?.ban ? 'black' : ''" 
                   class="fs-4">
                </i>
            </span>
            </div>
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Actions">
        <ng-template ngx-datatable-header-template>Actions</ng-template>
        <ng-template ngx-datatable-cell-template let-row="row">
            <div class="action-buttons">
                <button class="btn btn-info btn-sm" [routerLink]="['/pages/profile', row.email]">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-warning btn-sm" [routerLink]="['/edit-user', row.id]">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="deleteUser(row)">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </ng-template>
    </ngx-datatable-column>
    </ngx-datatable>
    

<!-- Pagination Controls -->
<div class="pagination-container d-flex justify-content-center mt-4">
    <pagination-controls 
        (pageChange)="currentPage = $event" 
        previousLabel="‹"
        nextLabel="›"
        firstLabel="«"
        lastLabel="»"
        class="d-flex justify-content-center">
    </pagination-controls>
</div>
